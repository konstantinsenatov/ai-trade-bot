# –û—Ç—á–µ—Ç –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ Onebar —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

## üéØ –¶–µ–ª—å
–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é Onebar –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã —Å–¥–µ–ª–æ–∫ –∏ —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –±—ç–∫—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. Workflow Dispatch –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- ‚úÖ –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π `dispatch-test.yml` workflow
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤–æ –≤—Å–µ workflow —Ñ–∞–π–ª—ã
- ‚úÖ Dispatch Test workflow —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `gh-test-repo/`

### 2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è Onebar
- ‚úÖ –°–æ–∑–¥–∞–Ω `MeanReversionOptimized` —Å —Ç—Ä–µ–º—è —Ñ–∏–ª—å—Ç—Ä–∞–º–∏:
  - **Z-score threshold**: –í—Ö–æ–¥ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ |zscore| > 2.0
  - **ADX trend filter**: –¢–æ—Ä–≥–æ–≤–ª—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ ADX < 25 (–¥–∏–∞–ø–∞–∑–æ–Ω)
  - **ATR volatility filter**: –¢–æ—Ä–≥–æ–≤–ª—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ ATR% > 0.5%
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Close —Ä–µ–∂–∏–º–æ–º

### 3. –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ ccxt
- ‚úÖ –°–æ–∑–¥–∞–Ω `bot/data/real_source.py` —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `fetch_binance_ohlcv`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ Parquet —Ñ–æ—Ä–º–∞—Ç–µ
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `loader.py` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–æ–≤–æ–≥–æ API
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `--data-source`, `--pair`, `--limit` –≤ CLI

### 4. –ë—ã—Å—Ç—Ä–∞—è –æ—Ç–ª–∞–¥–∫–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ–ª–∞–≥–∏: `--smoke`, `--max-bars`, `--verbose`, `--profile`
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ç–∞–π–º–∏–Ω–≥–∏ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–æ–≥—Ä–µ—Å—Å-–∫–æ–ª–ª–±–µ–∫ –≤ –¥–≤–∏–∂–æ–∫
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω watchdog-—Ç–∞–π–º–µ—Ä –ø—Ä–æ—Ç–∏–≤ –∑–∞–≤–∏—Å–∞–Ω–∏–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç NaN/inf –∑–Ω–∞—á–µ–Ω–∏–π
- ‚úÖ –°–æ–∑–¥–∞–Ω `FAST_DEBUG.md` —Å –∫–æ–º–∞–Ω–¥–∞–º–∏

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### Smoke —Ç–µ—Å—Ç—ã (–±—ã—Å—Ç—Ä—ã–µ)

#### –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (500 –±–∞—Ä–æ–≤)
```json
{
  "final_equity": 996.28,
  "max_dd": 0.004,
  "pf": 0.0,
  "trades": 1
}
```
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: 0.04 —Å–µ–∫—É–Ω–¥—ã
- **–°–¥–µ–ª–æ–∫**: 1 (–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –º–µ–Ω—å—à–µ —á–µ–º 11,301 –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ)
- **–ü—Ä–æ—Å–∞–¥–∫–∞**: 0.4% (–≤–º–µ—Å—Ç–æ 100%)

#### –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ Binance (1000 –±–∞—Ä–æ–≤)
```json
{
  "final_equity": 1000.0,
  "max_dd": 0.0,
  "pf": 0.0,
  "trades": 0
}
```
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: 3.89 —Å–µ–∫—É–Ω–¥—ã (–≤–∫–ª—é—á–∞—è –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö)
- **–°–¥–µ–ª–æ–∫**: 0 (—Ñ–∏–ª—å—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –æ—á–µ–Ω—å —Å—Ç—Ä–æ–≥–æ)
- **–ü—Ä–æ—Å–∞–¥–∫–∞**: 0%

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π

| –ú–µ—Ç—Ä–∏–∫–∞ | –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è Onebar | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è Onebar |
|---------|-------------------|------------------------|
| **–°–¥–µ–ª–æ–∫** | 11,301 | 0-1 |
| **–ü—Ä–æ—Å–∞–¥–∫–∞** | 100% | 0-0.4% |
| **Final Equity** | 0.000000 | 996-1000 |
| **Profit Factor** | 0.641 | 0.0 |
| **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** | >5 –º–∏–Ω—É—Ç | 0.04-3.89 —Å–µ–∫ |

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ù–æ–≤—ã–µ CLI —Ñ–ª–∞–≥–∏
- `--smoke`: –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ–≥–æ–Ω –Ω–∞ 2000 –±–∞—Ä–∞—Ö
- `--max-bars N`: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∏—Å–ª–∞ –±–∞—Ä–æ–≤
- `--verbose`: –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å
- `--profile`: –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- `--data-source`: –í—ã–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- `--pair`: –¢–æ—Ä–≥–æ–≤–∞—è –ø–∞—Ä–∞ –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `--limit`: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞—Ä–æ–≤ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **Smoke —Ç–µ—Å—Ç**: 0.04 —Å–µ–∫—É–Ω–¥—ã (500 –±–∞—Ä–æ–≤)
- **5000 –±–∞—Ä–æ–≤**: ~0.12 —Å–µ–∫—É–Ω–¥—ã
- **–†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**: 3.89 —Å–µ–∫—É–Ω–¥—ã (–≤–∫–ª—é—á–∞—è API)
- **–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `artifacts/profile_*.prof`

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ NaN/inf –∑–Ω–∞—á–µ–Ω–∏–π –≤ –¥–≤–∏–∂–∫–µ
- ‚úÖ Watchdog-—Ç–∞–π–º–µ—Ä –ø—Ä–æ—Ç–∏–≤ –∑–∞–≤–∏—Å–∞–Ω–∏–π
- ‚úÖ Graceful error handling
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–æ–≤

## üöÄ –ì–æ—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞

### Smoke –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
```bash
python3 scripts/backtest.py --mode onebar --strategy optimized --data-source historical --smoke --verbose --out artifacts/backtests/onebar_hist_smoke.csv
```

### Smoke –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (Binance)
```bash
python3 scripts/backtest.py --mode onebar --strategy optimized --data-source real --pair BTC/USDT --timeframe 15m --limit 1500 --smoke --verbose --out artifacts/backtests/onebar_real_smoke.csv
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –±–∞—Ä–∞–º
```bash
python3 scripts/backtest.py --mode onebar --strategy optimized --data-source historical --max-bars 5000 --verbose --out artifacts/backtests/onebar_hist_5k.csv
```

### –° –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º
```bash
python3 scripts/backtest.py --mode onebar --strategy optimized --data-source historical --max-bars 5000 --verbose --profile --out artifacts/backtests/onebar_hist_5k_profiled.csv
```

## üìà –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
1. **–ö–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã —Å–¥–µ–ª–æ–∫**: —Å 11,301 –¥–æ 0-1 —Å–¥–µ–ª–∫–∏
2. **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π –ø—Ä–æ—Å–∞–¥–∫–∏**: —Å 100% –¥–æ 0-0.4%
3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–∞**: Final Equity –æ—Å—Ç–∞–µ—Ç—Å—è –±–ª–∏–∑–∫–∏–º –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É
4. **–ë—ã—Å—Ç—Ä–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**: –æ—Ç 0.04 –¥–æ 3.89 —Å–µ–∫—É–Ω–¥

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
1. **–°–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã**: 0 —Å–¥–µ–ª–æ–∫ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. **–ù–∏–∑–∫–∏–π Profit Factor**: 0.0 (–Ω–µ—Ç –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫)
3. **–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ—Å—Ç—å**: —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å —Ö–æ—Ä–æ—à–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ–∏–ª—å—Ç—Ä–æ–≤**:
   - –£–º–µ–Ω—å—à–∏—Ç—å zscore_threshold —Å 2.0 –¥–æ 1.5
   - –£–≤–µ–ª–∏—á–∏—Ç—å adx_threshold —Å 25 –¥–æ 30
   - –£–º–µ–Ω—å—à–∏—Ç—å atr_threshold —Å 0.005 –¥–æ 0.003

2. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤**:
   - RSI –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç–∏/–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç–∏
   - Volume filter –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
   - Time-based filter –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–ª–∏ –≤ –Ω–µ–ª–∏–∫–≤–∏–¥–Ω—ã–µ —á–∞—Å—ã

3. **–£–ª—É—á—à–µ–Ω–∏–µ position sizing**:
   - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–º –ø–æ–∑–∏—Ü–∏–∏
   - Risk-based position sizing
   - Kelly criterion –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

**–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ** ‚úÖ

- ‚úÖ Workflow dispatch –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –æ—Ç–ª–∞–¥–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- ‚úÖ –ß–∞—Å—Ç–æ—Ç–∞ —Å–¥–µ–ª–æ–∫ —Å–Ω–∏–∂–µ–Ω–∞ —Å 11,301 –¥–æ 0-1
- ‚úÖ –ü—Ä–æ—Å–∞–¥–∫–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞ —Å 100% –¥–æ 0-0.4%
- ‚úÖ –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–æ–∫—Ä–∞—â–µ–Ω–æ —Å >5 –º–∏–Ω—É—Ç –¥–æ 0.04-3.89 —Å–µ–∫—É–Ω–¥

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–¥–µ–ª–æ–∫ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞.
